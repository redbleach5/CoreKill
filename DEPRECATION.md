# План удаления устаревшего кода

Этот файл отслеживает код, который будет удалён после стабилизации стриминговых агентов.

## Когда удалять

**Условие**: После успешного тестирования стриминга в production (минимум 2 недели без багов).

**Как проверить готовность**:
```bash
# Все тесты проходят
python -m pytest tests/ -v

# Стриминг работает в UI
# 1. Запустить backend: uvicorn backend.main:app
# 2. Открыть frontend, отправить запрос
# 3. Убедиться что <think> блоки отображаются в реальном времени
```

---

## Файлы для удаления

### После стабилизации стриминга

| Файл | Причина | Заменён на |
|------|---------|------------|
| — | Синхронные агенты пока оставляем | — |

### Синхронные методы в стриминговых агентах

После полной миграции на стриминг можно удалить синхронные методы:

| Файл | Метод | Причина |
|------|-------|---------|
| `agents/streaming_coder.py` | `generate_code()`, `fix_code()` | Обёртки для обратной совместимости |
| `agents/streaming_planner.py` | `create_plan()` | Обёртка для обратной совместимости |
| `agents/streaming_test_generator.py` | `generate_tests()` | Обёртка для обратной совместимости |
| `agents/streaming_debugger.py` | `analyze_errors()` | Обёртка для обратной совместимости |
| `agents/streaming_reflection.py` | `reflect()` | Обёртка для обратной совместимости |
| `agents/streaming_critic.py` | `analyze()` | Обёртка для обратной совместимости |

---

## Архитектурное решение

### Текущая архитектура (переходная)

```
workflow_graph.py
    ├── Синхронные узлы (planner_node, coder_node, ...)
    │   └── Используют sync агенты через asyncio.to_thread()
    │
workflow_nodes.py  
    ├── stream_*_node() — для SSE стриминга в agent.py
    │   └── Используют Streaming* агенты
```

### Целевая архитектура (после стабилизации)

```
workflow_graph.py
    └── Узлы вызывают стриминговые агенты напрямую
    
agent.py (SSE router)
    └── Использует stream_*_node() для real-time вывода
```

---

## Чеклист перед удалением

- [ ] Стриминг `<think>` блоков работает в UI для всех этапов
- [ ] Кнопка "Стоп" прерывает генерацию
- [ ] Нет регрессий в качестве генерации кода
- [ ] Performance метрики не ухудшились
- [ ] Все тесты проходят
- [ ] Протестировано на reasoning моделях (deepseek-r1, qwq)

---

## История изменений

| Дата | Изменение |
|------|-----------|
| 2026-01-20 | Создан файл. Добавлены стриминговые агенты и узлы |
