## ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã

### 1. –ß—ë—Ç–∫–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –∞–≤—Ç–æ–Ω–æ–º–Ω–æ—Å—Ç—å

* ‚ùå –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
* ‚úÖ —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç
* ‚úÖ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ `confidence == 1.0`
* ‚úÖ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–µ
* ‚úÖ —É–≤–∞–∂–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã

–≠—Ç–æ **–∫–ª—é—á–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –ø–æ–±–µ–¥–∞** ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫ –≤—Ä–µ–¥–∞.

---

### 2. –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –∞–Ω–∞–ª–∏–∑

–¢—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å **—Ç—Ä–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞**:

1. AST-–∞–Ω–∞–ª–∏–∑ (—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π, –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
2. LLM-–∞–Ω–∞–ª–∏–∑ (—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π)
3. –í–µ–±-–ø–æ–∏—Å–∫ (best practices, fallback)

–≠—Ç–æ –ø–æ—á—Ç–∏ textbook-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è *hybrid static + AI analysis*.

---

### 3. –û—Ç–ª–∏—á–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏

* fallback –º–æ–¥–µ–ª–µ–π
* –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
* –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –º–æ–¥–µ–ª–µ–π
* graceful failure (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `[]`, –∞ –Ω–µ –ª–æ–º–∞–µ—Ç –ø–∞–π–ø–ª–∞–π–Ω)

–ú–æ–¥—É–ª—å **—É—Å—Ç–æ–π—á–∏–≤ –∫ —Å–±–æ—è–º**, –∞ —ç—Ç–æ —Ä–µ–¥–∫–æ—Å—Ç—å.

---

### 4. –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ ‚Äî üíØ

```python
_prioritize_files()
```

–û—á–µ–Ω—å —Å–∏–ª—å–Ω–∞—è —á–∞—Å—Ç—å:

* —Å–ª–æ–∂–Ω–æ—Å—Ç—å
* —Ä–∞–∑–º–µ—Ä
* –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ docstrings
* –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ—É–Ω–∫—Ü–∏–π/–∫–ª–∞—Å—Å–æ–≤

üëâ –≠—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –∞–Ω–∞–ª–∏–∑–∞ –∏ –ø–æ–≤—ã—à–∞–µ—Ç –ø–æ–ª–µ–∑–Ω–æ—Å—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.

---

### 5. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

* –æ—Ç–¥–µ–ª—å–Ω—ã–π –ª–æ–≥–≥–µ—Ä
* —Ñ–∞–π–ª + –∫–æ–Ω—Å–æ–ª—å
* emoji –¥–ª—è UX
* `propagate = False`

–î–ª—è —Ñ–æ–Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ ‚Äî –∏–¥–µ–∞–ª—å–Ω–æ.

---

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–∏—Å–∫–∏

–¢–µ–ø–µ—Ä—å ‚Äî –≤–∞–∂–Ω–æ–µ. –ù–∏–∂–µ –Ω–µ ¬´–ø—Ä–∏–¥–∏—Ä–∫–∏¬ª, –∞ —Ä–µ–∞–ª—å–Ω—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–∏—Å–∫–∏.

---

## 1. ‚ùó –ü—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–µ: 100% —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å vs LLM

### –ü—Ä–æ–±–ª–µ–º–∞

```python
min_confidence: float = 1.0
```

–ù–æ:

* LLM **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—ã–≤–∞–µ—Ç 100% —É–≤–µ—Ä–µ–Ω–Ω—ã–º**
* —Ç—ã –≤—Å—ë —Ä–∞–≤–Ω–æ:

  * –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—à—å `_cycles_without_progress`
  * –≤–∫–ª—é—á–∞–µ—à—å –≤–µ–±-–ø–æ–∏—Å–∫
  * –ø–æ–≤—Ç–æ—Ä—è–µ—à—å –∞–Ω–∞–ª–∏–∑

üëâ –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ —ç—Ç–æ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫:

* –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º ¬´–Ω—É–ª–µ–≤—ã–º¬ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º
* –ª–æ–∂–Ω–æ–º—É –æ—â—É—â–µ–Ω–∏—é, —á—Ç–æ –º–æ–¥—É–ª—å ¬´–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç¬ª

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

–†–∞–∑–¥–µ–ª–∏:

* **confidence LLM**
* **confidence —Å–∏—Å—Ç–µ–º—ã**

–ù–∞–ø—Ä–∏–º–µ—Ä:

```python
effective_confidence = (
    llm_confidence
    * ast_confidence
    * repetition_confidence
)
```

–ò–ª–∏:

* 0.95 ‚Äî –¥–æ–ø—É—Å—Ç–∏–º–æ
* 1.0 ‚Äî —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏:

  * –ø–æ–≤—Ç–æ—Ä—è–ª–æ—Å—å N —Ä–∞–∑
  * –Ω–µ –º–µ–Ω—è–ª—Å—è –∫–æ–¥
  * AST –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç

---

## 2. ‚ö†Ô∏è `_analyzed_files` –ª–æ–≥–∏—á–µ—Å–∫–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω

### –°–µ–π—á–∞—Å

```python
if file_suggestions:
    self._analyzed_files.add(file_path)
else:
    # –º–æ–∂–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
```

### –ü—Ä–æ–±–ª–µ–º–∞

* –§–∞–π–ª **–º–æ–∂–µ—Ç –±—ã—Ç—å –∏–¥–µ–∞–ª—å–Ω–æ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º**
* –ù–æ —Ç—ã –±—É–¥–µ—à—å:

  * –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ —Å–Ω–æ–≤–∞ –∏ —Å–Ω–æ–≤–∞
  * —Ç—Ä–∞—Ç–∏—Ç—å LLM —Ç–æ–∫–µ–Ω—ã
  * —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å `_files_without_high_confidence`

–≠—Ç–æ –Ω–µ ¬´—É–º–Ω–∞—è –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞¬ª, –∞ **–±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π churn**.

### –†–µ—à–µ–Ω–∏–µ

–•—Ä–∞–Ω–∏ —Å—Ç–∞—Ç—É—Å:

```python
enum FileAnalysisState:
    NO_ISSUES
    LOW_CONFIDENCE
    HIGH_CONFIDENCE
```

–ò timestamp –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.

---

## 3. ‚ùó `_ast_cache` –æ–±—ä—è–≤–ª–µ–Ω, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

```python
self._ast_cache: Dict[str, Optional[FileAnalysis]] = {}
```

–ù–æ:

* –¥–∞–ª—å—à–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `self._cache`
* `_ast_cache` –Ω–∏–≥–¥–µ –Ω–µ —á–∏—Ç–∞–µ—Ç—Å—è –∏ –Ω–µ –ø–∏—à–µ—Ç—Å—è

### –ò—Ç–æ–≥

* –ª–∏–±–æ –∑–∞–±—ã—Ç–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
* –ª–∏–±–æ –º—ë—Ä—Ç–≤—ã–π –∫–æ–¥

üëâ **–£–±—Ä–∞—Ç—å –∏–ª–∏ —Ä–µ–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.**

---

## 4. üîÅ Event loop –ª–æ–≥–∏–∫–∞ –∏–∑–±—ã—Ç–æ—á–Ω–∞

```python
try:
    loop = asyncio.get_event_loop()
    if not loop.is_running():
        self._task = asyncio.create_task(...)
```

### –ü—Ä–æ–±–ª–µ–º–∞

* `asyncio.create_task` **—Ç—Ä–µ–±—É–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ loop**
* –µ—Å–ª–∏ loop –Ω–µ –∑–∞–ø—É—â–µ–Ω ‚Äî –±—É–¥–µ—Ç RuntimeError

–¢—ã –≤—Å—ë —Ä–∞–≤–Ω–æ –≤ `except` –¥–µ–ª–∞–µ—à—å —Ç–æ –∂–µ —Å–∞–º–æ–µ.

### –£–ø—Ä–æ—â–µ–Ω–∏–µ

–õ–∏–±–æ:

* –≤—Å–µ–≥–¥–∞ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π loop
* –ª–∏–±–æ —è–≤–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —á–µ—Ä–µ–∑ `asyncio.run()`

–°–µ–π—á–∞—Å –∫–æ–¥ —Å–ª–æ–∂–Ω–µ–µ, —á–µ–º –Ω—É–∂–Ω–æ.

---

## 5. üß† Web-search —Ç—Ä–∏–≥–≥–µ—Ä –º–æ–∂–µ—Ç —à—É–º–µ—Ç—å

```python
_cycles_without_progress >= 2
_files_without_high_confidence >= 5
```

–ü—Ä–æ–±–ª–µ–º–∞:

* –ø—Ä–æ–≥—Ä–µ—Å—Å == —Ç–æ–ª—å–∫–æ `confidence >= 1.0`
* –∑–Ω–∞—á–∏—Ç web-search –±—É–¥–µ—Ç –≤–∫–ª—é—á–∞—Ç—å—Å—è **–ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞**

–†–µ–∑—É–ª—å—Ç–∞—Ç:

* –ª–∏—à–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã
* —à—É–º –≤ –ø—Ä–æ–º–ø—Ç–µ
* –≤–æ–∑–º–æ–∂–Ω–æ–µ —É—Ö—É–¥—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ LLM –æ—Ç–≤–µ—Ç–∞

üëâ –õ—É—á—à–µ:

* —É—á–∏—Ç—ã–≤–∞—Ç—å *–ª—é–±–æ–π* confidence ‚â• 0.8 –∫–∞–∫ ¬´—Å–ª–∞–±—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å¬ª
* –∏–ª–∏ —É—á–∏—Ç—ã–≤–∞—Ç—å AST-only findings

---

## 6. ‚ö†Ô∏è JSON-–ø–∞—Ä—Å–∏–Ω–≥ —Ö—Ä—É–ø–∫–∏–π

```python
json_start = response.find("{")
json_end = response.rfind("}") + 1
```

–ï—Å–ª–∏ LLM:

* –≤—Å—Ç–∞–≤–∏—Ç `{` –≤ –∫–æ–¥–µ
* –≤–µ—Ä–Ω—ë—Ç markdown
* –≤–µ—Ä–Ω—ë—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ JSON-–±–ª–æ–∫–æ–≤

üëâ –ø–∞—Ä—Å–µ—Ä —Å–ª–æ–º–∞–µ—Ç—Å—è –∏–ª–∏ –≤—ã—Ç–∞—â–∏—Ç –º—É—Å–æ—Ä.

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–≥–∏–π JSON mode (–µ—Å–ª–∏ LocalLLM –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç)
* –∏–ª–∏ regex –ø–æ `json` –±–ª–æ–∫—É
* –∏–ª–∏ streaming validation

---

## 7. üß© –°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –∫–ª–∞—Å—Å

`AutonomousImprover` —Å–µ–π—á–∞—Å:

* scheduler
* orchestrator
* cache manager
* LLM client
* AST client
* decision engine
* metrics provider

### –†–∏—Å–∫

* —Å–ª–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
* —Å–ª–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é

### –õ–æ–≥–∏—á–Ω–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ

–ú–∏–Ω–∏–º—É–º –Ω–∞:

* `ImproverScheduler`
* `FileAnalyzer`
* `SuggestionValidator`
* `ModelManager`
* `SearchAugmentor`

---

## üí° –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (high impact)

### 1. Confidence Accumulator (üî• —Ä–µ–∫–æ–º–µ–Ω–¥—É—é)

–ù–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å **–º–µ–∂–¥—É —Ü–∏–∫–ª–∞–º–∏**, –Ω–∞–ø—Ä–∏–º–µ—Ä:

* –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Å–æ–≤–µ—Ç –Ω–∞–π–¥–µ–Ω 3 —Ä–∞–∑–∞
* –∫–æ–¥ –Ω–µ –º–µ–Ω—è–ª—Å—è
* AST –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç

‚Üí —Ç–æ–≥–¥–∞ –º–æ–∂–Ω–æ —á–µ—Å—Ç–Ω–æ –≥–æ–≤–æ—Ä–∏—Ç—å –æ 1.0

---

### 2. –•—Ä–∞–Ω–∏—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ

–°–µ–π—á–∞—Å `_suggestions` –∂–∏–≤—ë—Ç –≤ –ø–∞–º—è—Ç–∏.

üëâ –ü—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ:

* –≤—Å—ë —Ç–µ—Ä—è–µ—Ç—Å—è
* confidence –Ω–µ –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è

–ú–∏–Ω–∏–º—É–º:

* JSON / SQLite
* —Å hash —Ñ–∞–π–ª–∞ + hash –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è

---

### 3. –Ø–≤–Ω—ã–π —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã

–ù–∞–ø—Ä–∏–º–µ—Ä:

* `PASSIVE` ‚Äî —Ç–æ–ª—å–∫–æ —Å–±–æ—Ä
* `ACTIVE` ‚Äî –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç
* `AUDIT` ‚Äî –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑

---

## üßæ –ò—Ç–æ–≥

### –ß—Ç–æ —É–∂–µ –æ—Ç–ª–∏—á–Ω–æ

* –∏–¥–µ—è
* –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
* —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å
* AST + LLM + Web
* –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è
* –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

1. –ü–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–Ω—Ü–µ–ø—Ü–∏—é `100% confidence`
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ ¬´—Ö–æ—Ä–æ—à–∏—Ö¬ª —Ñ–∞–π–ª–æ–≤
3. –£–±—Ä–∞—Ç—å/–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `_ast_cache`
4. –£–ø—Ä–æ—Å—Ç–∏—Ç—å event loop –ª–æ–≥–∏–∫—É
5. –£—Å–∏–ª–∏—Ç—å JSON-–ø–∞—Ä—Å–∏–Ω–≥
6. –ü–æ–¥—É–º–∞—Ç—å –æ —Ä–∞–∑–±–∏–µ–Ω–∏–∏ –∫–ª–∞—Å—Å–∞
