# Устранение проблем Autonomous Improver

## Проблема: KeyboardInterrupt при остановке

**Симптомы:**
```
asyncio.exceptions.CancelledError
KeyboardInterrupt
```

**Причина:** Нормальное поведение при остановке через Ctrl+C. Тест корректно обрабатывает прерывание.

**Решение:** ✅ Исправлено в последней версии. Тест теперь:
- Корректно обрабатывает KeyboardInterrupt
- Сохраняет результаты даже при прерывании
- Корректно останавливает фоновые задачи

## Проблема: Процесс остаётся висеть

**Симптомы:**
- Процесс виден в `ps aux` после остановки
- Тест не завершается полностью

**Решение:**
```bash
# Остановить все процессы теста
pkill -f "test_autonomous_improver"

# Или конкретный процесс
kill <PID>
```

**Предотвращение:** ✅ Улучшена обработка остановки в последней версии.

## Проблема: Тест не находит предложений

**Симптомы:**
- Тест работает, но предложений нет
- Логи показывают "предложений с высокой уверенностью не найдено"

**Причины:**
1. `min_confidence = 1.0` слишком строго (только 100% уверенность)
2. Код уже достаточно хорош
3. Модель слишком легкая

**Решение:**
```toml
# Временно снизьте для тестирования
min_confidence = 0.9  # Вместо 1.0
```

## Проблема: Медленная работа на слабом железе

**Симптомы:**
- Анализ файла занимает >60 секунд
- Система перегружена

**Решение:**
```toml
[autonomous_improver]
max_files_per_cycle = 3      # Вместо 5-10
cycle_interval = 900         # 15 минут вместо 10
model = "phi3:mini"          # Самая легкая модель
```

## Проблема: Ошибки при парсинге JSON

**Симптомы:**
```
⚠️ Ошибка парсинга JSON
⚠️ Не найден JSON в ответе LLM
```

**Причина:** LLM не всегда возвращает валидный JSON.

**Решение:** ✅ Модуль автоматически обрабатывает такие случаи и продолжает работу.

## Проблема: Много ошибок в логах

**Симптомы:**
- Множество ошибок в логах
- Тест продолжает работать, но с ошибками

**Проверка:**
1. Доступность Ollama: `ollama list`
2. Доступность модели: `ollama show phi3:mini`
3. Логи на детали ошибок

**Решение:**
- Убедитесь, что Ollama запущен
- Установите легкую модель: `ollama pull phi3:mini`
- Проверьте логи на конкретные ошибки

## Рекомендации для стабильной работы

1. **Используйте легкую модель:**
   ```toml
   model = "phi3:mini"  # Или "gemma3:1b"
   ```

2. **Настройте для вашего железа:**
   ```toml
   max_files_per_cycle = 5      # Для M2
   cycle_interval = 600         # 10 минут
   ```

3. **Мониторьте логи:**
   ```bash
   tail -f test_improver.log
   ```

4. **Проверяйте результаты периодически:**
   ```bash
   python3 scripts/analyze_improver_results.py test_improver_results.json
   ```
