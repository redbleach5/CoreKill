# Важно понимать: Персистентность задач

## Текущее поведение

**Задачи НЕ продолжают выполняться после перезапуска сервисов.**

### Как это работает сейчас:

1. **Выполнение в памяти:**
   - Задачи выполняются через SSE (Server-Sent Events) стриминг
   - Состояние задачи хранится только в памяти backend процесса
   - Frontend не сохраняет состояние в localStorage/sessionStorage

2. **При перезапуске backend:**
   - Все активные задачи **теряются**
   - Выполнение **прерывается**
   - Результаты **не сохраняются** (если задача не завершилась)

3. **При перезапуске frontend:**
   - Состояние UI **сбрасывается**
   - Прогресс выполнения **теряется**
   - Если backend продолжает выполнять задачу, frontend не увидит результаты

4. **Что сохраняется:**
   - ✅ Результаты успешно завершенных задач сохраняются в `output/{timestamp}/`
   - ✅ Опыт выполнения сохраняется в ChromaDB (MemoryAgent)
   - ❌ Состояние незавершенных задач **не сохраняется**

## Пользовательский опыт

### В UI отображается:

1. **Постоянное предупреждение в header:**
   - "⚠️ Задачи выполняются в памяти и не сохраняются при перезапуске сервисов"

2. **Предупреждение во время выполнения:**
   - Желтый баннер с текстом: "Важно: Задача выполняется в памяти. При перезапуске backend или frontend выполнение будет прервано и результаты не сохранятся. Дождитесь завершения задачи перед перезапуском сервисов."

3. **При разрыве соединения:**
   - Сообщение об ошибке: "Подключение к серверу закрыто. Задача была прервана. При перезапуске backend задачи не сохраняются и не продолжают выполняться."

## Будущие улучшения (опционально)

### Возможные решения для персистентности:

1. **Сохранение состояния задач:**
   - Сохранять состояние задач в БД (SQLite/PostgreSQL)
   - Восстанавливать выполнение после перезапуска
   - Позволить пользователю видеть историю задач

2. **Checkpoint система:**
   - Сохранять промежуточные результаты на каждом этапе
   - Возможность продолжить с последнего checkpoint

3. **Очередь задач:**
   - Использовать очередь (Redis/RabbitMQ) для задач
   - Гарантировать выполнение даже при перезапуске

4. **Frontend персистентность:**
   - Сохранять состояние в localStorage
   - Восстанавливать UI после перезагрузки страницы

### Текущий приоритет:

- ⚠️ **Низкий приоритет** - текущая реализация достаточна для большинства случаев
- Задачи обычно выполняются быстро (несколько минут)
- Результаты сохраняются после завершения
- Пользователи предупреждены о поведении

## Рекомендации для пользователей

1. **Дождитесь завершения задачи** перед перезапуском сервисов
2. **Не перезагружайте страницу** во время выполнения задачи
3. **Проверяйте `output/`** для сохраненных результатов
4. **Используйте `run.py`** для корректного запуска/остановки
