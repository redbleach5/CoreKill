# –ü–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —Ä–∞–∑–≤–∏—Ç–∏—è –ø—Ä–æ–µ–∫—Ç–∞ Cursor Killer

## –î–∞—Ç–∞: 2026-01-21

---

## üìä –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã ‚úÖ
- **–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: LangGraph workflow, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥
- **Reasoning models**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ DeepSeek-R1, QwQ —Å real-time —Å—Ç—Ä–∏–º–∏–Ω–≥–æ–º
- **–•–æ—Ä–æ—à–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: README, ARCHITECTURE, ROADMAP
- **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**: –ß—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ agents, infrastructure, backend
- **SmartModelRouter**: –£–º–Ω—ã–π –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–¥–∞—á–∏
- **–¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ**: 21 —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª

### –°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã ‚ö†Ô∏è
- **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞**: –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ + —Å—Ç—Ä–∏–º–∏–Ω–≥–æ–≤—ã–µ –∞–≥–µ–Ω—Ç—ã (–ø–µ—Ä–µ—Ö–æ–¥–Ω–∞—è —Ñ–∞–∑–∞)
- **–ü—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–π Context Engine**: –ù–µ—Ç AST –ø–∞—Ä—Å–∏–Ω–≥–∞, –≥—Ä–∞—Ñ–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Learning System**: –ù–µ—Ç –∞–Ω–∞–ª–∏–∑–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏
- **–ù–µ—Ç –º–µ—Ç—Ä–∏–∫**: Performance tracking –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ù–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—Ä–æ–º–ø—Ç–æ–≤
- **Observability**: –ù–µ—Ç structured logging, —Ç—Ä–µ–π—Å–∏–Ω–≥–∞, –¥–∞—à–±–æ—Ä–¥–æ–≤

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ (—Ç—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

### 1. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (Priority: CRITICAL)

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ù–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏/–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤ (prompt injection)
- –ù–µ—Ç rate limiting –Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö endpoints
- –í–µ–±-–ø–æ–∏—Å–∫ –º–æ–∂–µ—Ç –±—ã—Ç—å —É—è–∑–≤–∏–º (SSRF)
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ–º–æ–≥–æ –∫–æ–¥–∞

**–†–µ—à–µ–Ω–∏–µ:**
```python
# backend/security/auth.py
"""–ë–∞–∑–æ–≤–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ API keys."""

from fastapi import HTTPException, Security
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials
import secrets

security = HTTPBearer()

# –•—Ä–∞–Ω–µ–Ω–∏–µ API keys (–ø–æ–∑–∂–µ - –≤ –ë–î)
VALID_API_KEYS = set()

def generate_api_key() -> str:
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π API –∫–ª—é—á."""
    return secrets.token_urlsafe(32)

async def verify_api_key(credentials: HTTPAuthorizationCredentials = Security(security)):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç API –∫–ª—é—á."""
    if credentials.credentials not in VALID_API_KEYS:
        raise HTTPException(status_code=401, detail="Invalid API key")
    return credentials.credentials
```

```python
# backend/security/validation.py
"""–í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö."""

import re
from typing import Optional

MAX_PROMPT_LENGTH = 50000
MAX_CODE_LENGTH = 100000
DANGEROUS_PATTERNS = [
    r'__import__\s*\(',
    r'eval\s*\(',
    r'exec\s*\(',
    r'compile\s*\(',
    r'os\.system',
    r'subprocess\.',
]

class SecurityError(Exception):
    """–û—à–∏–±–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏."""
    pass

def validate_prompt(prompt: str) -> None:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–æ–º–ø—Ç –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å.
    
    Raises:
        SecurityError: –ï—Å–ª–∏ –ø—Ä–æ–º–ø—Ç –æ–ø–∞—Å–µ–Ω
    """
    if not prompt or not prompt.strip():
        raise SecurityError("Empty prompt")
    
    if len(prompt) > MAX_PROMPT_LENGTH:
        raise SecurityError(f"Prompt too long: {len(prompt)} > {MAX_PROMPT_LENGTH}")
    
    # –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ prompt injection
    suspicious = ['ignore previous', 'disregard', 'new instructions', 'system:']
    for pattern in suspicious:
        if pattern.lower() in prompt.lower():
            raise SecurityError(f"Suspicious pattern detected: {pattern}")

def validate_code(code: str) -> None:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ –Ω–∞ –æ–ø–∞—Å–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏."""
    if len(code) > MAX_CODE_LENGTH:
        raise SecurityError("Generated code too long")
    
    for pattern in DANGEROUS_PATTERNS:
        if re.search(pattern, code):
            raise SecurityError(f"Dangerous pattern: {pattern}")
```

**Checklist:**
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ API keys
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- [ ] Rate limiting –Ω–∞ `/api/stream` (10 req/min per user)
- [ ] Sandbox –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞
- [ ] HTTPS –≤ production
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è security best practices

**–í—Ä–µ–º—è:** 2-3 –¥–Ω—è

---

### 2. Observability –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Priority: HIGH)

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –õ–æ–≥–∏ –Ω–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ (—Å–ª–æ–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å)
- –ù–µ—Ç –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ù–µ—Ç —Ç—Ä–µ–π—Å–∏–Ω–≥–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –ù–µ—Ç –∞–ª–µ—Ä—Ç–æ–≤ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

**–†–µ—à–µ–Ω–∏–µ:**

```python
# infrastructure/telemetry.py
"""–¢–µ–ª–µ–º–µ—Ç—Ä–∏—è –∏ –º–µ—Ç—Ä–∏–∫–∏."""

from dataclasses import dataclass, field
from datetime import datetime
from typing import Dict, List, Optional
import time
import json
from pathlib import Path

@dataclass
class Metric:
    """–ú–µ—Ç—Ä–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏."""
    name: str
    value: float
    timestamp: datetime = field(default_factory=datetime.now)
    tags: Dict[str, str] = field(default_factory=dict)

class MetricsCollector:
    """–°–±–æ—Ä—â–∏–∫ –º–µ—Ç—Ä–∏–∫."""
    
    def __init__(self, output_file: Optional[Path] = None):
        self.metrics: List[Metric] = []
        self.output_file = output_file or Path("output/metrics.jsonl")
        self.output_file.parent.mkdir(exist_ok=True, parents=True)
    
    def record(self, name: str, value: float, **tags):
        """–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –º–µ—Ç—Ä–∏–∫—É."""
        metric = Metric(name=name, value=value, tags=tags)
        self.metrics.append(metric)
        
        # Append to JSONL file
        with open(self.output_file, 'a') as f:
            f.write(json.dumps({
                'name': metric.name,
                'value': metric.value,
                'timestamp': metric.timestamp.isoformat(),
                'tags': metric.tags
            }) + '\n')
    
    def timer(self, name: str, **tags):
        """Context manager –¥–ª—è –∑–∞–º–µ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏."""
        return MetricTimer(self, name, tags)

class MetricTimer:
    """–¢–∞–π–º–µ—Ä –¥–ª—è –º–µ—Ç—Ä–∏–∫."""
    
    def __init__(self, collector: MetricsCollector, name: str, tags: Dict):
        self.collector = collector
        self.name = name
        self.tags = tags
        self.start = 0.0
    
    def __enter__(self):
        self.start = time.time()
        return self
    
    def __exit__(self, *args):
        elapsed = time.time() - self.start
        self.collector.record(f"{self.name}_duration_seconds", elapsed, **self.tags)

# –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∫–æ–ª–ª–µ–∫—Ç–æ—Ä
_metrics = MetricsCollector()

def get_metrics() -> MetricsCollector:
    return _metrics
```

```python
# infrastructure/logging/structured.py
"""–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ."""

import logging
import json
from datetime import datetime
from typing import Any, Dict

class StructuredFormatter(logging.Formatter):
    """JSON —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä –¥–ª—è –ª–æ–≥–æ–≤."""
    
    def format(self, record: logging.LogRecord) -> str:
        log_data = {
            'timestamp': datetime.utcnow().isoformat(),
            'level': record.levelname,
            'logger': record.name,
            'message': record.getMessage(),
            'module': record.module,
            'function': record.funcName,
            'line': record.lineno
        }
        
        # –î–æ–±–∞–≤–ª—è–µ–º extra –ø–æ–ª—è
        if hasattr(record, 'extra'):
            log_data.update(record.extra)
        
        # –î–æ–±–∞–≤–ª—è–µ–º exception –µ—Å–ª–∏ –µ—Å—Ç—å
        if record.exc_info:
            log_data['exception'] = self.formatException(record.exc_info)
        
        return json.dumps(log_data)

def setup_structured_logging(level: int = logging.INFO):
    """–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ."""
    handler = logging.StreamHandler()
    handler.setFormatter(StructuredFormatter())
    
    logger = logging.getLogger()
    logger.setLevel(level)
    logger.addHandler(handler)
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∞–≥–µ–Ω—Ç–∞—Ö:**

```python
# agents/coder.py
from infrastructure.telemetry import get_metrics

class CoderAgent:
    def generate_code(self, ...):
        metrics = get_metrics()
        
        with metrics.timer("coder_generate", model=self.model, complexity=complexity):
            code = self.llm.generate(...)
        
        metrics.record("code_length_chars", len(code), model=self.model)
        
        return code
```

**Checklist:**
- [ ] Structured logging (JSON)
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (latency, tokens, success rate)
- [ ] Dashboard –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ (Grafana –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ–π HTML)
- [ ] Alerts –Ω–∞ –æ—à–∏–±–∫–∏ (email/Telegram)
- [ ] OpenTelemetry integration (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–í—Ä–µ–º—è:** 3-4 –¥–Ω—è

---

### 3. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –∏ —Ç–µ—Ö–¥–æ–ª–≥ (Priority: MEDIUM)

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∏ —Å—Ç—Ä–∏–º–∏–Ω–≥–æ–≤—ã–µ –∞–≥–µ–Ω—Ç—ã –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è
- –ù–µ—Ç –±–∞–∑–æ–≤–æ–≥–æ –∫–ª–∞—Å—Å–∞ –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤
- –ú–Ω–æ–≥–æ –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞ –≤ –ø—Ä–æ–º–ø—Ç–∞—Ö

**–†–µ—à–µ–Ω–∏–µ:**

```python
# agents/base.py
"""–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö –∞–≥–µ–Ω—Ç–æ–≤."""

from abc import ABC, abstractmethod
from typing import Optional, Dict, Any, AsyncGenerator
from dataclasses import dataclass
from infrastructure.local_llm import LocalLLM, create_llm_for_stage
from infrastructure.telemetry import get_metrics
from utils.logger import get_logger

logger = get_logger()

@dataclass
class AgentConfig:
    """–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–∞."""
    model: Optional[str] = None
    temperature: float = 0.25
    stage: str = "default"

class BaseAgent(ABC):
    """–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö –∞–≥–µ–Ω—Ç–æ–≤.
    
    –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
    - –õ–µ–Ω–∏–≤—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é LLM
    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫
    - –ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö/—Å—Ç—Ä–∏–º–∏–Ω–≥–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
    - –û–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
    """
    
    def __init__(self, config: Optional[AgentConfig] = None):
        self.config = config or AgentConfig()
        self._llm: Optional[LocalLLM] = None
        self.metrics = get_metrics()
    
    @property
    def llm(self) -> LocalLLM:
        """–õ–µ–Ω–∏–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è LLM."""
        if self._llm is None:
            self._llm = create_llm_for_stage(
                stage=self.config.stage,
                model=self.config.model or self._get_default_model(),
                temperature=self.config.temperature
            )
        return self._llm
    
    @abstractmethod
    def _get_default_model(self) -> str:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –∞–≥–µ–Ω—Ç–∞."""
        pass
    
    @abstractmethod
    def execute(self, **kwargs) -> Any:
        """–°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞–≥–µ–Ω—Ç–∞."""
        pass
    
    async def execute_stream(self, **kwargs) -> AsyncGenerator:
        """–°—Ç—Ä–∏–º–∏–Ω–≥–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)."""
        raise NotImplementedError(f"{self.__class__.__name__} –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å—Ç—Ä–∏–º–∏–Ω–≥")
    
    def _build_prompt(self, template: str, **kwargs) -> str:
        """–°—Ç—Ä–æ–∏—Ç –ø—Ä–æ–º–ø—Ç –∏–∑ —à–∞–±–ª–æ–Ω–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π."""
        from backend.security.validation import validate_prompt
        
        prompt = template.format(**kwargs)
        validate_prompt(prompt)
        return prompt
```

**–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ CoderAgent:**

```python
# agents/coder.py
from agents.base import BaseAgent, AgentConfig

class CoderAgent(BaseAgent):
    """–ê–≥–µ–Ω—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞."""
    
    # –®–∞–±–ª–æ–Ω –ø—Ä–æ–º–ø—Ç–∞ –≤—ã–Ω–µ—Å–µ–Ω –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É
    GENERATE_PROMPT = """You are an expert Python programmer.

TASK:
{plan}

TESTS TO PASS:
```python
{tests}
```

CONTEXT:
{context}

Generate clean, well-documented Python code that passes all tests.
Follow PEP8. Use type hints.

CODE:"""
    
    def __init__(self, model: Optional[str] = None, temperature: float = 0.25):
        super().__init__(AgentConfig(
            model=model,
            temperature=temperature,
            stage="coding"
        ))
    
    def _get_default_model(self) -> str:
        from infrastructure.model_router import get_model_router
        router = get_model_router()
        return router.select_model("coding").model
    
    def execute(self, plan: str, tests: str, context: str, **kwargs) -> str:
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–¥ (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)."""
        with self.metrics.timer("coder_execute", model=self.config.model):
            prompt = self._build_prompt(
                self.GENERATE_PROMPT,
                plan=plan,
                tests=tests,
                context=context
            )
            
            response = self.llm.generate(prompt, num_predict=4096)
            code = self._extract_code(response)
            
            self.metrics.record("code_generated_length", len(code))
            return code
    
    async def execute_stream(self, plan: str, tests: str, context: str, **kwargs):
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–¥ —Å —Å—Ç—Ä–∏–º–∏–Ω–≥–æ–º."""
        prompt = self._build_prompt(
            self.GENERATE_PROMPT,
            plan=plan,
            tests=tests,
            context=context
        )
        
        async for chunk in self.llm.generate_stream(prompt):
            if chunk.is_thinking:
                yield ("thinking", chunk.content)
            else:
                yield ("code_chunk", chunk.content)
        
        yield ("done", chunk.full_response)
```

**Checklist:**
- [ ] –°–æ–∑–¥–∞—Ç—å BaseAgent —Å –æ–±—â–µ–π –ª–æ–≥–∏–∫–æ–π
- [ ] –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –≤—Å–µ—Ö –∞–≥–µ–Ω—Ç–æ–≤ –Ω–∞ BaseAgent
- [ ] –í—ã–Ω–µ—Å—Ç–∏ –ø—Ä–æ–º–ø—Ç—ã –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã/—Ñ–∞–π–ª—ã
- [ ] –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è –∫–æ–¥
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã

**–í—Ä–µ–º—è:** 4-5 –¥–Ω–µ–π

---

## üü° –í–ê–ñ–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø (—Å–ª–µ–¥—É—é—â–∏–π —Å–ø—Ä–∏–Ω—Ç)

### 4. Context Engine v2 (Priority: HIGH)

**–¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- –ü—Ä–æ—Å—Ç–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —á–∞–Ω–∫–∏ –±–µ–∑ —É—á—ë—Ç–∞ AST
- –ù–µ—Ç –≥—Ä–∞—Ñ–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ù–µ—Ç –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏—Ö —Å–≤–æ–¥–æ–∫
- –ü—Ä–∏–º–∏—Ç–∏–≤–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏

**–†–µ—à–µ–Ω–∏–µ - –ø–æ—ç—Ç–∞–ø–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:**

**–≠—Ç–∞–ø 1: AST –ø–∞—Ä—Å–∏–Ω–≥ (1-2 –¥–Ω—è)**

```python
# infrastructure/context_engine_v2/ast_analyzer.py
"""AST –∞–Ω–∞–ª–∏–∑ –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–¥–∞."""

import ast
from dataclasses import dataclass, field
from typing import List, Dict, Set, Optional
from pathlib import Path

@dataclass
class CodeEntity:
    """–°—É—â–Ω–æ—Å—Ç—å –∫–æ–¥–∞ (—Ñ—É–Ω–∫—Ü–∏—è, –∫–ª–∞—Å—Å, –º–æ–¥—É–ª—å)."""
    name: str
    type: str  # "function" | "class" | "method" | "module"
    file_path: str
    start_line: int
    end_line: int
    signature: str
    docstring: Optional[str] = None
    
    # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
    imports: List[str] = field(default_factory=list)
    calls: List[str] = field(default_factory=list)
    inherits_from: List[str] = field(default_factory=list)
    
    # –ú–µ—Ç—Ä–∏–∫–∏
    complexity: int = 0  # Cyclomatic complexity
    lines_of_code: int = 0

class ASTAnalyzer:
    """–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–æ–¥ —á–µ—Ä–µ–∑ AST."""
    
    def analyze_file(self, file_path: Path) -> List[CodeEntity]:
        """–ü–∞—Ä—Å–∏—Ç —Ñ–∞–π–ª –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Å—É—â–Ω–æ—Å—Ç–∏."""
        content = file_path.read_text()
        tree = ast.parse(content)
        
        entities: List[CodeEntity] = []
        
        # –ò–∑–≤–ª–µ–∫–∞–µ–º imports
        imports = self._extract_imports(tree)
        
        # –ò–∑–≤–ª–µ–∫–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –∫–ª–∞—Å—Å—ã
        for node in ast.walk(tree):
            if isinstance(node, ast.FunctionDef):
                entity = self._analyze_function(node, file_path, content, imports)
                entities.append(entity)
            elif isinstance(node, ast.ClassDef):
                entity = self._analyze_class(node, file_path, content, imports)
                entities.append(entity)
        
        return entities
    
    def _extract_imports(self, tree: ast.AST) -> List[str]:
        """–ò–∑–≤–ª–µ–∫–∞–µ—Ç –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã."""
        imports = []
        for node in ast.walk(tree):
            if isinstance(node, ast.Import):
                for alias in node.names:
                    imports.append(alias.name)
            elif isinstance(node, ast.ImportFrom):
                module = node.module or ""
                for alias in node.names:
                    imports.append(f"{module}.{alias.name}")
        return imports
    
    def _analyze_function(
        self,
        node: ast.FunctionDef,
        file_path: Path,
        content: str,
        imports: List[str]
    ) -> CodeEntity:
        """–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é."""
        # –ò–∑–≤–ª–µ–∫–∞–µ–º –≤—ã–∑–æ–≤—ã —Ñ—É–Ω–∫—Ü–∏–π
        calls = []
        for child in ast.walk(node):
            if isinstance(child, ast.Call):
                if isinstance(child.func, ast.Name):
                    calls.append(child.func.id)
        
        # Cyclomatic complexity
        complexity = self._calculate_complexity(node)
        
        return CodeEntity(
            name=node.name,
            type="function",
            file_path=str(file_path),
            start_line=node.lineno,
            end_line=node.end_lineno or node.lineno,
            signature=self._get_signature(node, content),
            docstring=ast.get_docstring(node),
            imports=imports,
            calls=calls,
            complexity=complexity,
            lines_of_code=(node.end_lineno or node.lineno) - node.lineno
        )
    
    def _calculate_complexity(self, node: ast.AST) -> int:
        """–í—ã—á–∏—Å–ª—è–µ—Ç —Ü–∏–∫–ª–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–ª–æ–∂–Ω–æ—Å—Ç—å."""
        complexity = 1  # –ë–∞–∑–æ–≤–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å
        
        for child in ast.walk(node):
            if isinstance(child, (ast.If, ast.While, ast.For, ast.ExceptHandler)):
                complexity += 1
            elif isinstance(child, ast.BoolOp):
                complexity += len(child.values) - 1
        
        return complexity
    
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã
```

**–≠—Ç–∞–ø 2: –ì—Ä–∞—Ñ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (2-3 –¥–Ω—è)**

```python
# infrastructure/context_engine_v2/dependency_graph.py
"""–ì—Ä–∞—Ñ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∫–æ–¥–∞."""

from typing import Dict, List, Set
from dataclasses import dataclass
import networkx as nx

@dataclass
class DependencyGraph:
    """–ì—Ä–∞—Ñ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ø—Ä–æ–µ–∫—Ç–∞."""
    
    def __init__(self):
        self.graph = nx.DiGraph()
    
    def add_entity(self, entity: CodeEntity):
        """–î–æ–±–∞–≤–ª—è–µ—Ç —Å—É—â–Ω–æ—Å—Ç—å –≤ –≥—Ä–∞—Ñ."""
        self.graph.add_node(
            entity.name,
            type=entity.type,
            file=entity.file_path,
            complexity=entity.complexity
        )
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Ä—ë–±—Ä–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
        for call in entity.calls:
            self.graph.add_edge(entity.name, call, type="calls")
        
        for parent in entity.inherits_from:
            self.graph.add_edge(entity.name, parent, type="inherits")
    
    def get_dependencies(self, entity_name: str, max_depth: int = 2) -> List[str]:
        """–ü–æ–ª—É—á–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å—É—â–Ω–æ—Å—Ç–∏."""
        if entity_name not in self.graph:
            return []
        
        # BFS –¥–ª—è –ø–æ–∏—Å–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
        dependencies = []
        visited = set()
        queue = [(entity_name, 0)]
        
        while queue:
            current, depth = queue.pop(0)
            if current in visited or depth > max_depth:
                continue
            
            visited.add(current)
            dependencies.append(current)
            
            # –î–æ–±–∞–≤–ª—è–µ–º —Å–æ—Å–µ–¥–µ–π
            for neighbor in self.graph.successors(current):
                queue.append((neighbor, depth + 1))
        
        return dependencies[1:]  # –ò—Å–∫–ª—é—á–∞–µ–º —Å–∞–º—É —Å—É—â–Ω–æ—Å—Ç—å
    
    def get_important_entities(self, top_n: int = 10) -> List[str]:
        """–ù–∞—Ö–æ–¥–∏—Ç –≤–∞–∂–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ PageRank."""
        if len(self.graph) == 0:
            return []
        
        pagerank = nx.pagerank(self.graph)
        sorted_entities = sorted(pagerank.items(), key=lambda x: x[1], reverse=True)
        
        return [name for name, score in sorted_entities[:top_n]]
```

**Checklist:**
- [ ] AST –ø–∞—Ä—Å–∏–Ω–≥ –¥–ª—è Python
- [ ] –ì—Ä–∞—Ñ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ networkx
- [ ] PageRank –¥–ª—è –≤–∞–∂–Ω–æ—Å—Ç–∏
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ResearcherAgent
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∞
- [ ] –¢–µ—Å—Ç—ã

**–í—Ä–µ–º—è:** 4-5 –¥–Ω–µ–π

---

### 5. Learning System (Priority: MEDIUM)

**–¶–µ–ª—å:** –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —É—á–∏—Ç—å—Å—è –Ω–∞ —Å–≤–æ–∏—Ö —É—Å–ø–µ—Ö–∞—Ö –∏ –æ—à–∏–±–∫–∞—Ö.

```python
# infrastructure/learning_system.py
"""–°–∏—Å—Ç–µ–º–∞ –æ–±—É—á–µ–Ω–∏—è –Ω–∞ –æ–ø—ã—Ç–µ."""

import sqlite3
from dataclasses import dataclass
from datetime import datetime
from typing import List, Optional, Dict
from pathlib import Path

@dataclass
class TaskResult:
    """–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏."""
    task: str
    intent_type: str
    complexity: str
    model_used: str
    success: bool
    quality_score: float
    duration_seconds: float
    error_type: Optional[str] = None
    timestamp: datetime = datetime.now()

class LearningSystem:
    """–°–∏—Å—Ç–µ–º–∞ –æ–±—É—á–µ–Ω–∏—è –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏."""
    
    def __init__(self, db_path: Path = Path("output/learning.db")):
        self.db_path = db_path
        self._init_db()
    
    def _init_db(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ë–î."""
        with sqlite3.connect(self.db_path) as conn:
            conn.execute("""
                CREATE TABLE IF NOT EXISTS task_results (
                    id INTEGER PRIMARY KEY,
                    task TEXT,
                    intent_type TEXT,
                    complexity TEXT,
                    model_used TEXT,
                    success BOOLEAN,
                    quality_score REAL,
                    duration_seconds REAL,
                    error_type TEXT,
                    timestamp DATETIME
                )
            """)
            
            conn.execute("""
                CREATE TABLE IF NOT EXISTS model_performance (
                    model_name TEXT,
                    task_type TEXT,
                    complexity TEXT,
                    avg_quality REAL,
                    success_rate REAL,
                    avg_duration REAL,
                    total_tasks INTEGER,
                    last_updated DATETIME,
                    PRIMARY KEY (model_name, task_type, complexity)
                )
            """)
    
    def record_result(self, result: TaskResult):
        """–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–¥–∞—á–∏."""
        with sqlite3.connect(self.db_path) as conn:
            conn.execute("""
                INSERT INTO task_results (
                    task, intent_type, complexity, model_used,
                    success, quality_score, duration_seconds,
                    error_type, timestamp
                ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
            """, (
                result.task, result.intent_type, result.complexity,
                result.model_used, result.success, result.quality_score,
                result.duration_seconds, result.error_type,
                result.timestamp
            ))
        
        # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –º–æ–¥–µ–ª–∏
        self._update_model_stats(result)
    
    def _update_model_stats(self, result: TaskResult):
        """–û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–∏."""
        with sqlite3.connect(self.db_path) as conn:
            # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            row = conn.execute("""
                SELECT avg_quality, success_rate, avg_duration, total_tasks
                FROM model_performance
                WHERE model_name = ? AND task_type = ? AND complexity = ?
            """, (result.model_used, result.intent_type, result.complexity)).fetchone()
            
            if row:
                # –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫–æ–ª—å–∑—è—â–µ–µ —Å—Ä–µ–¥–Ω–µ–µ
                avg_quality, success_rate, avg_duration, total = row
                new_total = total + 1
                
                new_avg_quality = (avg_quality * total + result.quality_score) / new_total
                new_success_rate = (success_rate * total + (1 if result.success else 0)) / new_total
                new_avg_duration = (avg_duration * total + result.duration_seconds) / new_total
                
                conn.execute("""
                    UPDATE model_performance
                    SET avg_quality = ?, success_rate = ?, avg_duration = ?,
                        total_tasks = ?, last_updated = ?
                    WHERE model_name = ? AND task_type = ? AND complexity = ?
                """, (
                    new_avg_quality, new_success_rate, new_avg_duration,
                    new_total, datetime.now(),
                    result.model_used, result.intent_type, result.complexity
                ))
            else:
                # –ü–µ—Ä–≤–∞—è –∑–∞–ø–∏—Å—å
                conn.execute("""
                    INSERT INTO model_performance VALUES (?, ?, ?, ?, ?, ?, ?, ?)
                """, (
                    result.model_used, result.intent_type, result.complexity,
                    result.quality_score, 1 if result.success else 0,
                    result.duration_seconds, 1, datetime.now()
                ))
    
    def get_best_model(self, task_type: str, complexity: str) -> Optional[str]:
        """–ù–∞—Ö–æ–¥–∏—Ç –ª—É—á—à—É—é –º–æ–¥–µ–ª—å –¥–ª—è –∑–∞–¥–∞—á–∏."""
        with sqlite3.connect(self.db_path) as conn:
            row = conn.execute("""
                SELECT model_name, avg_quality, success_rate
                FROM model_performance
                WHERE task_type = ? AND complexity = ?
                  AND total_tasks >= 5  -- –ú–∏–Ω–∏–º—É–º 5 –∑–∞–¥–∞—á –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏
                ORDER BY (avg_quality * 0.7 + success_rate * 0.3) DESC
                LIMIT 1
            """, (task_type, complexity)).fetchone()
            
            return row[0] if row else None
    
    def get_common_errors(self, limit: int = 10) -> List[Dict]:
        """–ù–∞—Ö–æ–¥–∏—Ç —á–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏."""
        with sqlite3.connect(self.db_path) as conn:
            rows = conn.execute("""
                SELECT error_type, COUNT(*) as count,
                       AVG(quality_score) as avg_quality
                FROM task_results
                WHERE success = 0 AND error_type IS NOT NULL
                GROUP BY error_type
                ORDER BY count DESC
                LIMIT ?
            """, (limit,)).fetchall()
            
            return [
                {'error_type': row[0], 'count': row[1], 'avg_quality': row[2]}
                for row in rows
            ]
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ workflow:**

```python
# infrastructure/workflow_nodes.py

from infrastructure.learning_system import LearningSystem, TaskResult

learning = LearningSystem()

@workflow_node(stage="reflection")
async def reflection_node(state: AgentState) -> AgentState:
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏ ...
    
    # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ Learning System
    result = TaskResult(
        task=state.get("task", ""),
        intent_type=state.get("intent_result").type,
        complexity=state.get("intent_result").complexity.value,
        model_used=state.get("model", "unknown"),
        success=state.get("validation_results", {}).get("all_passed", False),
        quality_score=reflection_result.overall_score,
        duration_seconds=time.time() - state.get("start_time", time.time()),
        error_type=state.get("debug_result").error_type if state.get("debug_result") else None
    )
    
    learning.record_result(result)
    
    return state
```

**Checklist:**
- [ ] SQLite –ë–î –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- [ ] –ó–∞–ø–∏—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–µ–π
- [ ] API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
- [ ] Dashboard –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ CSV/JSON

**–í—Ä–µ–º—è:** 3-4 –¥–Ω—è

---

## üü¢ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø (–±—ç–∫–ª–æ–≥)

### 6. Performance Optimization

**–¶–µ–ª–∏:**
- –£–º–µ–Ω—å—à–∏—Ç—å latency –Ω–∞ 30%
- –£–≤–µ–ª–∏—á–∏—Ç—å throughput –≤ 2x
- –°–Ω–∏–∑–∏—Ç—å memory usage –Ω–∞ 20%

**–ú–µ—Ç–æ–¥—ã:**
1. **Connection Pooling –≤–µ–∑–¥–µ:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å httpx pool –¥–ª—è Ollama
   - Redis –¥–ª—è –∫—ç—à–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

2. **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è:**
   - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ (Researcher + TestGenerator)
   - Batch processing –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–∞–¥–∞—á

3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - LRU cache –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ö—ç—à LLM –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤

4. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤:**
   - –°–æ–∫—Ä–∞—Ç–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã –Ω–∞ 20-30%
   - –£–±—Ä–∞—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

**–í—Ä–µ–º—è:** 5-7 –¥–Ω–µ–π

---

### 7. Frontend Improvements

**–ù–µ–æ–±—Ö–æ–¥–∏–º–æ:**

1. **ThinkingBlock –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:**
```tsx
// frontend/src/components/ThinkingBlock.tsx
import { useState } from 'react'
import { ChevronDown, Brain } from 'lucide-react'

interface ThinkingBlockProps {
  content: string
  isStreaming?: boolean
}

export function ThinkingBlock({ content, isStreaming = false }: ThinkingBlockProps) {
  const [collapsed, setCollapsed] = useState(true)
  
  return (
    <div className="border border-blue-300 rounded-lg bg-blue-50 dark:bg-blue-900/20 p-4">
      <button
        onClick={() => setCollapsed(!collapsed)}
        className="flex items-center gap-2 text-blue-700 dark:text-blue-300"
      >
        <Brain size={16} />
        <span className="font-medium">
          {isStreaming ? 'Thinking...' : 'Reasoning Process'}
        </span>
        <ChevronDown
          size={16}
          className={`transition-transform ${collapsed ? '' : 'rotate-180'}`}
        />
      </button>
      
      {!collapsed && (
        <pre className="mt-3 text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap">
          {content}
        </pre>
      )}
    </div>
  )
}
```

2. **–ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–ª—è –¥–æ–ª–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:**
```tsx
// frontend/src/components/ProgressBar.tsx
import { Progress } from '@/components/ui/progress'

const STAGES = [
  'intent', 'planning', 'research', 'testing',
  'coding', 'validation', 'reflection'
]

export function WorkflowProgress({ currentStage }: { currentStage: string }) {
  const progress = (STAGES.indexOf(currentStage) + 1) / STAGES.length * 100
  
  return (
    <div className="space-y-2">
      <Progress value={progress} className="h-2" />
      <div className="flex justify-between text-xs text-gray-500">
        {STAGES.map(stage => (
          <span
            key={stage}
            className={currentStage === stage ? 'text-blue-600 font-medium' : ''}
          >
            {stage}
          </span>
        ))}
      </div>
    </div>
  )
}
```

3. **Offline mode:**
   - Service Worker –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
   - IndexedDB –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–≤
   - Sync –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

**–í—Ä–µ–º—è:** 4-5 –¥–Ω–µ–π

---

### 8. Testing Improvements

**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –ø–æ–∫—Ä—ã—Ç–∏—è, –Ω–µ—Ç E2E —Ç–µ—Å—Ç–æ–≤

**–ü–ª–∞–Ω:**

1. **Unit —Ç–µ—Å—Ç—ã - —Ü–µ–ª—å 80% –ø–æ–∫—Ä—ã—Ç–∏–µ:**
```bash
pytest tests/ --cov=agents --cov=infrastructure --cov-report=html
```

2. **Integration —Ç–µ—Å—Ç—ã:**
```python
# tests/test_integration_workflow.py
"""E2E —Ç–µ—Å—Ç—ã –ø–æ–ª–Ω–æ–≥–æ workflow."""

import pytest
from infrastructure.workflow_graph import create_workflow

@pytest.mark.asyncio
async def test_full_workflow_simple_task():
    """–¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ workflow –¥–ª—è –ø—Ä–æ—Å—Ç–æ–π –∑–∞–¥–∞—á–∏."""
    workflow = create_workflow()
    
    initial_state = {
        "task": "–Ω–∞–ø–∏—à–∏ —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Å–ª–æ–∂–µ–Ω–∏—è –¥–≤—É—Ö —á–∏—Å–µ–ª",
        "model": "qwen2.5-coder:7b",
        "temperature": 0.25
    }
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º workflow
    final_state = await workflow.ainvoke(initial_state)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    assert final_state["code"] != ""
    assert "def " in final_state["code"]
    assert final_state["validation_results"]["all_passed"] == True
    assert final_state["reflection_result"].overall_score > 0.7
```

3. **Load tests:**
```python
# tests/test_load.py
"""–ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã."""

import asyncio
import pytest
from httpx import AsyncClient

@pytest.mark.asyncio
async def test_concurrent_requests():
    """–¢–µ—Å—Ç 10 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤."""
    async with AsyncClient() as client:
        tasks = [
            client.get("http://localhost:8000/api/stream?task=hello")
            for _ in range(10)
        ]
        
        results = await asyncio.gather(*tasks)
        
        # –í—Å–µ –¥–æ–ª–∂–Ω—ã –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è —É—Å–ø–µ—à–Ω–æ
        assert all(r.status_code == 200 for r in results)
```

**–í—Ä–µ–º—è:** 5-6 –¥–Ω–µ–π

---

## üìÖ Roadmap —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –°–ø—Ä–∏–Ω—Ç 1 (2 –Ω–µ–¥–µ–ª–∏): –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´
- [ ] –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (authentication, validation)
- [ ] Observability (structured logging, metrics)
- [ ] –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è (BaseAgent)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–æ–¥–∞–∫—à–Ω-–≥–æ—Ç–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å security –∏ monitoring

---

### –°–ø—Ä–∏–Ω—Ç 2 (2 –Ω–µ–¥–µ–ª–∏): –í–ê–ñ–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø
- [ ] Context Engine v2 (AST + –≥—Ä–∞—Ñ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
- [ ] Learning System (SQLite analytics)
- [ ] Performance optimization (connection pool, caching)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ —Å–∫–æ—Ä–æ—Å—Ç–∏

---

### –°–ø—Ä–∏–Ω—Ç 3 (2 –Ω–µ–¥–µ–ª–∏): –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –§–ò–ß–ò
- [ ] Frontend improvements (ThinkingBlock, ProgressBar, offline)
- [ ] Testing (80% coverage, E2E, load tests)
- [ ] Code Retrieval (–§–∞–∑–∞ 4 –∏–∑ roadmap)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π UX –∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å

---

### –°–ø—Ä–∏–Ω—Ç 4 (1-2 –Ω–µ–¥–µ–ª–∏): –ë–£–î–£–©–ï–ï
- [ ] Multi-Agent Debate (–§–∞–∑–∞ 5)
- [ ] Tree-sitter –¥–ª—è –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç–∏
- [ ] –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (Celery/RQ)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è enterprise-—Å–∏—Å—Ç–µ–º–∞

---

## üéØ –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
- [ ] Code coverage >= 80%
- [ ] Type hints coverage >= 90%
- [ ] No critical security issues
- [ ] Linter warnings < 10

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- [ ] Median latency < 30s –¥–ª—è simple –∑–∞–¥–∞—á
- [ ] Median latency < 120s –¥–ª—è complex –∑–∞–¥–∞—á
- [ ] Throughput >= 10 req/min
- [ ] Memory usage < 2GB

### –ö–∞—á–µ—Å—Ç–≤–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- [ ] Success rate >= 85% –¥–ª—è simple
- [ ] Success rate >= 70% –¥–ª—è medium
- [ ] Success rate >= 60% –¥–ª—è complex
- [ ] –ö–æ–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è —Å—Ä–∞–∑—É >= 80%

### UX/Frontend
- [ ] Loading state –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] Error handling –¥–ª—è –≤—Å–µ—Ö —Å–ª—É—á–∞–µ–≤
- [ ] Mobile responsive
- [ ] Accessibility (WCAG AA)

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã
1. **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ—Å—Ç—å:** –ù–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å –≤—Å—ë —Å—Ä–∞–∑—É, –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ —É–ª—É—á—à–∞—Ç—å
2. **Backward compatibility:** –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å API –ø—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ
3. **Test-driven:** –ü–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –ü–ï–†–ï–î —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–æ–º
4. **Documentation-first:** –û–±–Ω–æ–≤–ª—è—Ç—å –¥–æ–∫–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å –∫–æ–¥–æ–º
5. **–ú–µ—Ç—Ä–∏–∫–∏:** –ò–∑–º–µ—Ä—è—Ç—å –≤—Å—ë, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–∞–∫—Ç–∏–∫–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
1. **Code review:** –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ PR —Å review
2. **CI/CD:** –ê–≤—Ç–æ—Ç–µ—Å—Ç—ã –Ω–∞ –∫–∞–∂–¥—ã–π commit
3. **Conventional commits:** –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ commit messages
4. **Semantic versioning:** –ü–æ–Ω—è—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤–µ—Ä—Å–∏–π
5. **Changelog:** –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è
- **Security first:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- **User experience:** UX –≤–∞–∂–Ω–µ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –¥–µ—Ç–∞–ª–µ–π
- **Performance:** –°–∫–æ—Ä–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ –∏–∑–±—ã—Ç–æ—á–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- **Simplicity:** –ü—Ä–æ—Å—Ç–æ—Ç–∞ –≤–∞–∂–Ω–µ–µ —Å–ª–æ–∂–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [ROADMAP_2026.md](ROADMAP_2026.md) - –û–±—â–∏–π roadmap
- [code_retrieval.md](code_retrieval.md) - –î–µ—Ç–∞–ª–∏ –§–∞–∑—ã 4
- [context_engine_ast_parsing.md](context_engine_ast_parsing.md) - –î–µ—Ç–∞–ª–∏ –§–∞–∑—ã 6
- [../ARCHITECTURE.md](../ARCHITECTURE.md) - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- [../DEPRECATION.md](../DEPRECATION.md) - –ü–ª–∞–Ω —É–¥–∞–ª–µ–Ω–∏—è —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ –∫–æ–¥–∞

---

**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2026-01-21  
**–í–µ—Ä—Å–∏—è:** 1.0
